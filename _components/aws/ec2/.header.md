# AWS EC2 Module

Terraform module which creates EC2 resources on AWS provided by Terraform AWS provider.

## Usage
```hcl
module "ec2" { 
  source         = "git@github.com:examplae/ec2.git"
  aws_region    = "ap-southeast-1"
  master_prefix = "dev"
  # assume_role    = "arn:aws:iam::111222333444:role/AWSAFTExecution"
  image_id       = "ami-02453f5468b897e31" # Needed if not launch from template
  key_name       = "example-keypair"
  subnet_ids     = ["subnet-e707d7af", "subnet-3502a253"]
  instance_count = 2
  instance_type  = "t3.micro"
  instance_name  = "test-instance-name"
  root_block_device_mappings = [
    {
      volume_type = "gp3"
      volume_size = 20
      encrypted   = false
      kms_key_id  = null
    }
  ]
  
  vpc_security_group_ids = ["sg-0a928560674711bd8"]
  security_groups        = {}
  
  #### Launch template configuration ####
  launch_from_launch_template = true
  create_launch_template      = true
  launch_template_name        = "test-template"
  
  # template_user_data = "example.sh"
  image_id = "ami-02453f5468b897e31"
  # template_instance_type = "t2.micro"
  ebs_block_device_mappings = [{
    device_name = "/dev/sda1"
    ebs = {
      volume_size = 20
      volume_type = "gp3"
    }
  }]
  
  vpc_id                           = "vpc-3fdd2259"
  disable_api_termination = true # enables EC2 instance termination protection
  monitoring       = true
  placement = {
    availability_zone = "ap-southeast-1a"
  }
  template_network_interfaces = [{ delete_on_termination = true }]
  iam_instance_profile = {
    name = "ec2-admin-role"
  }
  
  instance_market_options = {
    market_type = "spot"
  
    spot_options = {
      instance_interruption_behavior = "terminate"
    }
  }
  
  instance_requirements = {
    memory_mib = {
      min = 1
      max = 3
    }
    total_local_storage_gb = {
      min = 20
      max = 30
    }
    vcpu_count = {
      min = 1
      max = 2
    }
    allowed_instance_types = ["t2.micro", "t3.micro"]
    bare_metal             = "excluded"
  }
  
  launch_template_tags = {
    Environment = "dev"
  }
  
  tags = {
    App = "example"
  }
  
  ### Custom launch template
  # launch_template = {
  #   name    = "test-custom"
  #   version = "6"
  # }
}
```
